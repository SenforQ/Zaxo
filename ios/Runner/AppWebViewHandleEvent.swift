
//: Declare String Begin

/*: "getDeviceID" :*/
fileprivate let viewLaunchFoundationName:[Character] = ["g","e","t","D","e","v","i","c","e","I"]
fileprivate let data_backgroundCancelName:[Character] = ["D"]

/*: "getFirebaseID" :*/
fileprivate let k_promiseDict:String = "explode option presentgetFi"
fileprivate let app_acceptList:String = "d"

/*: "getAreaISO" :*/
fileprivate let main_eventPath:[Character] = ["g","e","t","A","r","e"]
fileprivate let cacheFromTime:String = "aISOdomain down mic window original"

/*: "getProxyStatus" :*/
fileprivate let viewTunFlag:String = "getProshared index control"
fileprivate let controllerManagerState:String = "atfroms"

/*: "getMicStatus" :*/
fileprivate let helperPointState:String = "getMialways recover"

/*: "getPhotoStatus" :*/
fileprivate let managerPlayingPeriodList:[Character] = ["g","e","t","P","h","o","t","o","S","t","a","t","u","s"]

/*: "getCameraStatus" :*/
fileprivate let appInstallData:[Character] = ["g","e","t","C","a","m","e","r","a","S","t","a","t","u"]
fileprivate let showTurnString:String = "album"

/*: "reportAdjust" :*/
fileprivate let notiLabDict:String = "REPO"

/*: "requestLocalPush" :*/
fileprivate let app_pathProductUrl:String = "reqpresente"
fileprivate let serviceCarrierTapDate:String = "false soundstLoca"

/*: "getLangCode" :*/
fileprivate let managerNowError:[Character] = ["g","e","t","L","a","n","g","C","o"]
fileprivate let showWhiteToken:[Character] = ["d","e"]

/*: "getTimeZone" :*/
fileprivate let k_publicTransportStr:[Character] = ["g","e","t","T","i","m","e","Z","o"]
fileprivate let noti_elementDestinationUrl:[Character] = ["n","e"]

/*: "getInstalledApps" :*/
fileprivate let engineFormatKey:String = "number writer servergetIn"
fileprivate let kSourceCount:String = "need interval usededApps"

/*: "getSystemUUID" :*/
fileprivate let main_reduceError:String = "act used continue color installgetSy"
fileprivate let factoryPoorTingResult:String = "stemUUIDsearch request option"

/*: "getCountryCode" :*/
fileprivate let noti_solarDayURL:String = "getCounpare phone path calendar"
fileprivate let cacheAssessmentMode:[Character] = ["t"]
fileprivate let managerAccessPareOutsideValue:[Character] = ["r","y","C","o","d","e"]

/*: "inAppRating" :*/
fileprivate let controllerTitleError:[Character] = ["i","n","A","p","p"]
fileprivate let routerPolicyUserFlag:[Character] = ["R","a","t","i","n","g"]

/*: "apPay" :*/
fileprivate let viewLabelDataName:String = "apPaydeadline show"

/*: "subscribe" :*/
fileprivate let dataPoorValue:String = "sscreensc"

/*: "openSystemBrowser" :*/
fileprivate let app_yourFoundationURL:[Character] = ["o","p","e","n","S","y","s","t","e","m","B","r"]
fileprivate let configAddVersion:[Character] = ["o","w","s","e","r"]

/*: "closeWebview" :*/
fileprivate let const_agentUrl:[Character] = ["c","l","o","s","e","W","e","b","v","i","e","w"]

/*: "openNewWebview" :*/
fileprivate let parserAfterString:String = "day background adjustmentopenNe"
fileprivate let k_stopURL:String = "wWebviewclass request try"

/*: "reloadWebview" :*/
fileprivate let k_newsItemValue:String = "rneveroa"
fileprivate let networkSelfPropelledVehicleFormat:String = "dWebviewwhite name self"

/*: "openSettings" :*/
fileprivate let helperServerLargeFlag:String = "openSeif fire"
fileprivate let cacheModelName:[Character] = ["s"]

/*: "getNotificationStatus" :*/
fileprivate let noti_cameraLoopPath:String = "getNotsum available quantity run object"
fileprivate let networkMapDate:String = "ikitc"
fileprivate let show_onId:String = "challenge open will allow actionnStatus"

/*: "setScheduledLocalPush" :*/
fileprivate let dataEarState:String = "component path wait needsetSchedu"
fileprivate let const_thatCount:[Character] = ["l","e","d","L","o","c","a","l","P","u","s","h"]

/*: "typeName" :*/
fileprivate let cachePointURL:[UInt8] = [0x34,0x39,0x30,0x25,0xe,0x21,0x2d,0x25]

private func revenueScreen(window num: UInt8) -> UInt8 {
    return num ^ 64
}

/*: "deviceID" :*/
fileprivate let helperReferenceUnitTime:[UInt8] = [0x2e,0x2f,0x3c,0x23,0x29,0x2f,0x3,0xe]

private func createResult(phone num: UInt8) -> UInt8 {
    return num ^ 74
}

/*: "fireBaseID" :*/
fileprivate let sessionEventMessage:[UInt8] = [0xbb,0xbe,0xc7,0xba,0x97,0xb6,0xc8,0xba,0x9e,0x99]

fileprivate func minifyPanel(clear num: UInt8) -> UInt8 {
    let value = Int(num) - 85
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "areaISO" :*/
fileprivate let appLinkCount:[UInt8] = [0x4f,0x53,0x49,0x61,0x65,0x72,0x61]

/*: "isProxy" :*/
fileprivate let showLabTime:[UInt8] = [0x65,0x6f,0x4c,0x6e,0x6b,0x74,0x75]

fileprivate func firstNow(wait num: UInt8) -> UInt8 {
    let value = Int(num) - 252
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "langCode" :*/
fileprivate let noti_secondItemTitle:[UInt8] = [0xc2,0xb7,0xc4,0xbd,0x99,0xc5,0xba,0xbb]

fileprivate func adjustPresentation(page num: UInt8) -> UInt8 {
    let value = Int(num) + 170
    if value > 255 {
        return UInt8(value - 256)
    } else {
        return UInt8(value)
    }
}

/*: "timeZone" :*/
fileprivate let controllerEndMsg:[UInt8] = [0x52,0x4f,0x4b,0x43,0x7c,0x49,0x48,0x43]

private func responseColor(poor num: UInt8) -> UInt8 {
    return num ^ 38
}

/*: "installedApps" :*/
fileprivate let managerPlainProductMode:[UInt8] = [0xc1,0xc6,0xdb,0xdc,0xc9,0xc4,0xc4,0xcd,0xcc,0xe9,0xd8,0xd8,0xdb]

private func fieldEvent(input num: UInt8) -> UInt8 {
    return num ^ 168
}

/*: "systemUUID" :*/
fileprivate let k_scriptCanKey:[UInt8] = [0x9e,0xa4,0x9e,0x9f,0x90,0x98,0x80,0x80,0x74,0x6f]

fileprivate func pointFoundation(later num: UInt8) -> UInt8 {
    let value = Int(num) - 43
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "countryCode" :*/
fileprivate let modelAllowAgentMessage:[UInt8] = [0xe4,0xf0,0xf6,0xef,0xf5,0xf3,0xfa,0xc4,0xf0,0xe5,0xe6]

fileprivate func inputNo(lab num: UInt8) -> UInt8 {
    let value = Int(num) - 129
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "status" :*/
fileprivate let const_accessFrameSecret:[UInt8] = [0x68,0x69,0x56,0x69,0x6a,0x68]

fileprivate func pareFoundation(minimum num: UInt8) -> UInt8 {
    let value = Int(num) + 11
    if value > 255 {
        return UInt8(value - 256)
    } else {
        return UInt8(value)
    }
}

/*: "isAuth" :*/
fileprivate let networkDecideFlag:[UInt8] = [0xb7,0xad,0x9f,0xab,0xaa,0xb6]

/*: "isFirst" :*/
fileprivate let forwardDeadlineKey:[UInt8] = [0x4e,0x54,0x61,0x4e,0x55,0x54,0x53]

/*: __LocalPush" :*/
fileprivate let managerGroupName:[Character] = ["_","_","L","o","c","a","l","P","u"]
fileprivate let helperRevenueName:String = "shide"

/*: "identifier" :*/
fileprivate let showAppStr:[UInt8] = [0xa8,0xa5,0xa4,0xaf,0xb5,0xa8,0xa7,0xa8,0xa4,0xb3]

private func secondBelow(warn num: UInt8) -> UInt8 {
    return num ^ 193
}

/*: "HTTPProxy" :*/
fileprivate let serviceStatusLogFlag:[Character] = ["H","T","T","P","P","r","o","x","y"]

/*: "HTTPSProxy" :*/
fileprivate let notiSuccessError:String = "HcolorcolorPS"

/*: "SOCKSProxy" :*/
fileprivate let serviceInstallMode:String = "SOCdisplayS"
fileprivate let configMDeviceState:String = "Proxyfloat phone"

/*: "__SCOPED__" :*/
fileprivate let engineNetString:[Character] = ["_","_"]
fileprivate let data_filterId:String = "click index barSCOPED__"

/*: "tap" :*/
fileprivate let app_installOptionPresentStatus:[Character] = ["t","a","p"]

/*: "tun" :*/
fileprivate let factoryEnvironmentSumValue:[Character] = ["t","u","n"]

/*: "ipsec" :*/
fileprivate let engineActionId:String = "IPSEC"

/*: "ppp" :*/
fileprivate let kTopDict:String = "spacespacespace"

/*: "Retry After or Go to " :*/
fileprivate let networkProductSecret:String = "Retrsuccess product permission script"
fileprivate let controllerAllowTotalMode:String = "temp intervalter "
fileprivate let parserDisappearFormat:String = "sum let access to "

/*: "Feedback" :*/
fileprivate let appHeadValue:String = "Feesecond log enter current between"
fileprivate let viewBurLayerMessage:String = "dbupk"

/*: " to contact us" :*/
fileprivate let user_allowUrl:String = " to contaserver application head receive"
fileprivate let controllerNaturalReplaceDate:[Character] = ["c","t"," ","u","s"]

//: Declare String End

// __DEBUG__
// __CLOSE_PRINT__
//
//  AppWebViewHandleEvent.swift
//  OverseaH5
//
//  Created by young on 2025/9/23.
//

//: import CoreTelephony
import CoreTelephony
//: import FirebaseMessaging
import FirebaseMessaging
//: import HandyJSON
import HandyJSON
//: import StoreKit
import StoreKit
//: import UIKit
import UIKit

/// H5事件
//: private let getDeviceID     = "getDeviceID"        // 获取设备号
private let userPromiseMsg     = (String(viewLaunchFoundationName) + String(data_backgroundCancelName))        // 获取设备号
//: private let getFirebaseID   = "getFirebaseID"      // 获取FireBaseToken
private let kTransformStr   = (String(k_promiseDict.suffix(5)) + "rebaseI" + app_acceptList.uppercased())      // 获取FireBaseToken
//: private let getAreaISO      = "getAreaISO"         // 获取 SIM/运营商 地区ISO
private let loggerInsideQuantityRecoverTitle      = (String(main_eventPath) + String(cacheFromTime.prefix(4)))         // 获取 SIM/运营商 地区ISO
//: private let getProxyStatus  = "getProxyStatus"     // 获取是否使用了代理
private let factoryReplaceMode  = (String(viewTunFlag.prefix(6)) + "xySt" + controllerManagerState.replacingOccurrences(of: "from", with: "u"))     // 获取是否使用了代理
//: private let getMicStatus    = "getMicStatus"       // 获取麦克风权限
private let viewTimeExistingString    = (String(helperPointState.prefix(5)) + "cStatus")       // 获取麦克风权限
//: private let getPhotoStatus  = "getPhotoStatus"     // 获取相册权限
private let factoryLevelPath  = (String(managerPlayingPeriodList))     // 获取相册权限
//: private let getCameraStatus = "getCameraStatus"    // 获取相机权限
private let parserPicResult = (String(appInstallData) + showTurnString.replacingOccurrences(of: "album", with: "s"))    // 获取相机权限
//: private let reportAdjust    = "reportAdjust"       // 上报Adjust
private let data_capablenessMessage    = (notiLabDict.lowercased() + "rtAdjust")       // 上报Adjust
//: private let requestLocalPush = "requestLocalPush"  // APP在后台收到音视频通话推送
private let engineMicExamineVersionKey = (app_pathProductUrl.replacingOccurrences(of: "present", with: "u") + String(serviceCarrierTapDate.suffix(6)) + "lPush")  // APP在后台收到音视频通话推送
//: private let getLangCode      = "getLangCode"        // 获取系统语言
private let managerInsideStr      = (String(managerNowError) + String(showWhiteToken))        // 获取系统语言
//: private let getTimeZone      = "getTimeZone"        // 获取当前系统时区
private let configPlainDestinationProgressTime      = (String(k_publicTransportStr) + String(noti_elementDestinationUrl))        // 获取当前系统时区
//: private let getInstalledApps = "getInstalledApps"   // 获取已安装应用列表
private let loggerReplaceRatingList = (String(engineFormatKey.suffix(5)) + "stall" + String(kSourceCount.suffix(6)))   // 获取已安装应用列表
//: private let getSystemUUID    = "getSystemUUID"      // 获取系统UUID
private let controllerSaverStartCount    = (String(main_reduceError.suffix(5)) + String(factoryPoorTingResult.prefix(8)))      // 获取系统UUID
//: private let getCountryCode   = "getCountryCode"     // 获取当前系统地区
private let app_elementSwitchceKey   = (String(noti_solarDayURL.prefix(7)) + String(cacheAssessmentMode) + String(managerAccessPareOutsideValue))     // 获取当前系统地区
//: private let inAppRating      = "inAppRating"        // 应用内评分
private let engineSumUnitError      = (String(controllerTitleError) + String(routerPolicyUserFlag))        // 应用内评分
//: private let apPay            = "apPay"              // 苹果支付
private let notiPromiseVersion            = (String(viewLabelDataName.prefix(5)))              // 苹果支付
//: private let subscribe        = "subscribe"          // 苹果支付-订阅
private let managerTimeRequestUrl        = (dataPoorValue.replacingOccurrences(of: "screen", with: "ub") + "ribe")          // 苹果支付-订阅
//: private let openSystemBrowser = "openSystemBrowser" // 调用系统浏览器打开url
private let appSuccessValue = (String(app_yourFoundationURL) + String(configAddVersion)) // 调用系统浏览器打开url
//: private let closeWebview     = "closeWebview"       // 关闭当前webview
private let helperCaptureValue     = (String(const_agentUrl))       // 关闭当前webview
//: private let openNewWebview   = "openNewWebview"     // 使用新webview打开url
private let loggerUnitStatus   = (String(parserAfterString.suffix(6)) + String(k_stopURL.prefix(8)))     // 使用新webview打开url
//: private let reloadWebview    = "reloadWebview"      // 重载webView
private let routerPareURL    = (k_newsItemValue.replacingOccurrences(of: "never", with: "el") + String(networkSelfPropelledVehicleFormat.prefix(8)))      // 重载webView
//: private let openSettings = "openSettings"                   // v2.0.4新增：打开通知设置页
private let engineGetPath = (String(helperServerLargeFlag.prefix(6)) + "tting" + String(cacheModelName))                   // v2.0.4新增：打开通知设置页
//: private let getNotificationStatus = "getNotificationStatus" // v2.0.4新增：获取通知权限
private let parserUserTitle = (String(noti_cameraLoopPath.prefix(6)) + networkMapDate.replacingOccurrences(of: "kit", with: "fi") + "atio" + String(show_onId.suffix(7))) // v2.0.4新增：获取通知权限
//: private let setScheduledLocalPush = "setScheduledLocalPush" // v2.0.5新增：设置定时本地消息推送
private let cutCameraMode = (String(dataEarState.suffix(9)) + String(const_thatCount)) // v2.0.5新增：设置定时本地消息推送

//: struct JSMessageModel: HandyJSON {
struct ThreadModel: HandyJSON {
    //: var typeName = ""
    var typeName = ""
    //: var token: String?
    var token: String?
    //: var totalCount: Double?
    var totalCount: Double?

    //: var showText: String?
    var showText: String?
    //: var data: UserInfoModel?
    var data: RawModel?
    // 内购/订阅 H5参数
    //: var goodsId: String?
    var goodsId: String?     // 商品Id
    //: var source: Int?
    var source: Int?         // 充值来源
    //: var type: Int?
    var type: Int?           // 订阅入口；1：首页banner，2：全屏充值页，3：半屏充值页，4：领取金币弹窗
    //: var url: String?
    var url: String?         // url
    //: var fullscreen: Int?
    var fullscreen: Int?     // fullscreen：0:页面从状态栏以下渲染 1:全屏
    //: var transparency: Int?
    var transparency: Int?   // transparency：0-webview白色背景 1-webview透明背景
    //: var time: [Int]?
    var time: [Int]?         // 本地推送当天时间（24小时制）
    //: var msg: [String]?
    var msg: [String]?       // 本地推送文案
}

//: struct UserInfoModel: HandyJSON {
struct RawModel: HandyJSON {
    //: var headPic: String?
    var headPic: String?   // 头像
    //: var nickname: String?
    var nickname: String?  // 昵称
    //: var uid: String?
    var uid: String?       // 用户Id
}

//: extension AppWebViewController {
extension PartyViewController {
    //: func handleH5Message(schemeDic: [String: Any], callBack: @escaping (_ backDic: [String: Any]) -> Void) {
    func with(schemeDic: [String: Any], callBack: @escaping (_ backDic: [String: Any]) -> Void) {
        //: if let model = JSMessageModel.deserialize(from: schemeDic) {
        if let model = ThreadModel.deserialize(from: schemeDic) {
            //: switch model.typeName {
            switch model.typeName {
            //: case getDeviceID:
            case userPromiseMsg:
                //: let adidStr = AppAdjustManager.getAdjustAdid()
                let adidStr = RawEscape.of()
                //: callBack(["typeName": model.typeName, "deviceID": adidStr])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: helperReferenceUnitTime.map{createResult(phone: $0)}, encoding: .utf8)!: adidStr])

            //: case getFirebaseID:
            case kTransformStr:
                //: AppWebViewController.getFireBaseToken { str in
                PartyViewController.hideObserver { str in
                    //: callBack(["typeName": model.typeName, "fireBaseID": str])
                    callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: sessionEventMessage.map{minifyPanel(clear: $0)}, encoding: .utf8)!: str])
                }
                
            //: case getAreaISO:
            case loggerInsideQuantityRecoverTitle:
                //: let arr = AppWebViewController.getCountryISOCode()
                let arr = PartyViewController.remove()
                //: callBack(["typeName": model.typeName, "areaISO": arr.joined(separator: ",")])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: appLinkCount.reversed(), encoding: .utf8)!: arr.joined(separator: ",")])
                
            //: case getProxyStatus:
            case factoryReplaceMode:
                //: let status = AppWebViewController.getUsedProxyStatus()
                let status = PartyViewController.utilized()
                //: callBack(["typeName": model.typeName, "isProxy": status])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: showLabTime.map{firstNow(wait: $0)}, encoding: .utf8)!: status])
              
            //: case getLangCode:
            case managerInsideStr:
                //: let langCode = UIDevice.langCode
                let langCode = UIDevice.langCode
                //: callBack(["typeName": model.typeName, "langCode": langCode])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: noti_secondItemTitle.map{adjustPresentation(page: $0)}, encoding: .utf8)!: langCode])
                
            //: case getTimeZone:
            case configPlainDestinationProgressTime:
                //: let timeZone = UIDevice.timeZone
                let timeZone = UIDevice.timeZone
                //: callBack(["typeName": model.typeName, "timeZone": timeZone])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: controllerEndMsg.map{responseColor(poor: $0)}, encoding: .utf8)!: timeZone])
                
            //: case getInstalledApps:
            case loggerReplaceRatingList:
                //: let apps = UIDevice.getInstalledApps
                let apps = UIDevice.getInstalledApps
                //: callBack(["typeName": model.typeName, "installedApps": apps])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: managerPlainProductMode.map{fieldEvent(input: $0)}, encoding: .utf8)!: apps])
                
            //: case getSystemUUID:
            case controllerSaverStartCount:
                //: let uuid = UIDevice.systemUUID
                let uuid = UIDevice.systemUUID
                //: callBack(["typeName": model.typeName, "systemUUID": uuid])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: k_scriptCanKey.map{pointFoundation(later: $0)}, encoding: .utf8)!: uuid])
                
            //: case getCountryCode:
            case app_elementSwitchceKey:
                //: let countryCode = UIDevice.countryCode
                let countryCode = UIDevice.countryCode
                //: callBack(["typeName": model.typeName, "countryCode": countryCode])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: modelAllowAgentMessage.map{inputNo(lab: $0)}, encoding: .utf8)!: countryCode])
                
            //: case inAppRating:
            case engineSumUnitError:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName])
                //: AppWebViewController.requestInAppRating()
                PartyViewController.message()

            //: case apPay:
            case notiPromiseVersion:
                //: if let goodsId = model.goodsId, let source = model.source {
                if let goodsId = model.goodsId, let source = model.source {
                    //: self.applePay(productId: goodsId, source: source, payType: .Pay) { success in
                    self.color(productId: goodsId, source: source, payType: .Pay) { success in
                        //: callBack(["typeName": model.typeName, "status": success])
                        callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: const_accessFrameSecret.map{pareFoundation(minimum: $0)}, encoding: .utf8)!: success])
                    }
                }

            //: case subscribe:
            case managerTimeRequestUrl:
                //: if let goodsId = model.goodsId {
                if let goodsId = model.goodsId {
                    //: self.applePay(productId: goodsId, payType: .Subscribe) { success in
                    self.color(productId: goodsId, payType: .Subscribe) { success in
                        //: callBack(["typeName": model.typeName, "status": success])
                        callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: const_accessFrameSecret.map{pareFoundation(minimum: $0)}, encoding: .utf8)!: success])
                    }
                }
                
            //: case openSystemBrowser:
            case appSuccessValue:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName])
                //: if let urlStr = model.url, let openURL = URL(string: urlStr) {
                if let urlStr = model.url, let openURL = URL(string: urlStr) {
                    //: UIApplication.shared.open(openURL, options: [:], completionHandler: nil)
                    UIApplication.shared.open(openURL, options: [:], completionHandler: nil)
                }
                
            //: case closeWebview:
            case helperCaptureValue:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName])
                //: self.closeWeb()
                self.head()
                
            //: case openNewWebview:
            case loggerUnitStatus:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName])
                //: if let urlStr = model.url,
                if let urlStr = model.url,
                    //: let transparency = model.transparency,
                    let transparency = model.transparency,
                    //: let fullscreen = model.fullscreen {
                    let fullscreen = model.fullscreen {
                    //: AppWebViewController.openNewWebView(urlStr, transparency, fullscreen)
                    PartyViewController.writerSName(urlStr, transparency, fullscreen)
                }
                
            //: case reloadWebview:
            case routerPareURL:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName])
                //: self.reloadWebView()
                self.group()
            
            //: case openSettings:
            case engineGetPath:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName])
                //: if let url = URL(string: UIApplication.openSettingsURLString) {
                if let url = URL(string: UIApplication.openSettingsURLString) {
                    //: UIApplication.shared.open(url, options: [:], completionHandler: { _ in })
                    UIApplication.shared.open(url, options: [:], completionHandler: { _ in })
                }
                
            //: case setScheduledLocalPush:
            case cutCameraMode:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName])
                //: LocalPushScheduler.shared.schedule(times: model.time ?? [], contents: model.msg ?? [])
                DependentDisabled.shared.decision(times: model.time ?? [], contents: model.msg ?? [])
                
            //: case getNotificationStatus:
            case parserUserTitle:
                //: AppPermissionTool.shared.requestNotificationPermission { auth, isFirst in
                DeletePunchDelay.shared.outsideDismiss { auth, isFirst in
                    //: callBack(["typeName": model.typeName, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: networkDecideFlag.map{$0^222}, encoding: .utf8)!: auth, String(bytes: forwardDeadlineKey.map{$0^39}, encoding: .utf8)!: isFirst])
                }
            
            //: case getMicStatus:
            case viewTimeExistingString:
                //: AppPermissionTool.shared.requestMicPermission { auth, isFirst in
                DeletePunchDelay.shared.used { auth, isFirst in
                    //: callBack(["typeName": model.typeName, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: networkDecideFlag.map{$0^222}, encoding: .utf8)!: auth, String(bytes: forwardDeadlineKey.map{$0^39}, encoding: .utf8)!: isFirst])
                }
                
            //: case getPhotoStatus:
            case factoryLevelPath:
                //: AppPermissionTool.shared.requestPhotoPermission { auth, isFirst in
                DeletePunchDelay.shared.current { auth, isFirst in
                    //: callBack(["typeName": model.typeName, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: networkDecideFlag.map{$0^222}, encoding: .utf8)!: auth, String(bytes: forwardDeadlineKey.map{$0^39}, encoding: .utf8)!: isFirst])
                }
                
            //: case getCameraStatus:
            case parserPicResult:
                //: AppPermissionTool.shared.requestCameraPermission { auth, isFirst in
                DeletePunchDelay.shared.mic { auth, isFirst in
                    //: callBack(["typeName": model.typeName, "isAuth": auth, "isFirst": isFirst])
                    callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName, String(bytes: networkDecideFlag.map{$0^222}, encoding: .utf8)!: auth, String(bytes: forwardDeadlineKey.map{$0^39}, encoding: .utf8)!: isFirst])
                }
                
            //: case reportAdjust:
            case data_capablenessMessage:
                //: if let token = model.token {
                if let token = model.token {
                    //: if let count = model.totalCount {
                    if let count = model.totalCount {
                        //: AppAdjustManager.addPurchasedEvent(token: token, count: count)
                        RawEscape.purchase(token: token, count: count)
                    //: } else {
                    } else {
                        //: AppAdjustManager.addEvent(token: token)
                        RawEscape.countercalateRunMakeup(token: token)
                    }
                }
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName])

            //: case requestLocalPush:
            case engineMicExamineVersionKey:
                //: callBack(["typeName": model.typeName])
                callBack([String(bytes: cachePointURL.map{revenueScreen(window: $0)}, encoding: .utf8)!: model.typeName])
                //: AppWebViewController.pushLocalNotification(model)
                PartyViewController.file(model)

            //: default: break
            default: break
            }
        }
    }
}

// MARK: - Event
//: extension AppWebViewController {
extension PartyViewController {
    /// 打开新的webview
    /// - Parameters:
    ///   - urlStr: web地址
    ///   - transparency: 0：白色背景 1：透明背景
    ///   - fullscreen: 0:页面从状态栏以下渲染  1：全屏
    //: class func openNewWebView(_ urlStr: String, _ transparency: Int = 0, _ fullscreen: Int = 1) {
    class func writerSName(_ urlStr: String, _ transparency: Int = 0, _ fullscreen: Int = 1) {
        //: let vc = AppWebViewController()
        let vc = PartyViewController()
        //: vc.urlString = urlStr
        vc.urlString = urlStr
        //: vc.clearBgColor = (transparency == 1)
        vc.clearBgColor = (transparency == 1)
        //: vc.fullscreen = (fullscreen == 1)
        vc.fullscreen = (fullscreen == 1)
        //: vc.modalPresentationStyle = .fullScreen
        vc.modalPresentationStyle = .fullScreen
        //: AppConfig.currentViewController()?.present(vc, animated: true)
        IndicatorDisableBegin.laissezPasser()?.present(vc, animated: true)
    }
    
    /// 本地推送
    //: class func pushLocalNotification(_ model: JSMessageModel) {
    class func file(_ model: ThreadModel) {
        //: guard UIApplication.shared.applicationState != .active else { return }
        guard UIApplication.shared.applicationState != .active else { return }
        //: UNUserNotificationCenter.current().getNotificationSettings { setting in
        UNUserNotificationCenter.current().getNotificationSettings { setting in
            //: switch setting.authorizationStatus {
            switch setting.authorizationStatus {
            //: case .notDetermined, .denied, .ephemeral:
            case .notDetermined, .denied, .ephemeral:
                //: print("本地推送通知 -- 用户未授权\(setting.authorizationStatus)")
                //: print()
                print()
                
            //: case .provisional, .authorized:
            case .provisional, .authorized:
                //: if let dataModel = model.data {
                if let dataModel = model.data {
                    //: let content = UNMutableNotificationContent()
                    let content = UNMutableNotificationContent()
                    //: content.title = dataModel.nickname ?? ""
                    content.title = dataModel.nickname ?? ""
                    //: content.body = model.showText ?? ""
                    content.body = model.showText ?? ""
                    //: let identifier = dataModel.uid ?? "\(AppName)__LocalPush"
                    let identifier = dataModel.uid ?? "\(noti_areaName)" + (String(managerGroupName) + helperRevenueName.replacingOccurrences(of: "hide", with: "h"))
                    //: content.userInfo = ["identifier": identifier]
                    content.userInfo = [String(bytes: showAppStr.map{secondBelow(warn: $0)}, encoding: .utf8)!: identifier]
                    //: content.sound = UNNotificationSound.default
                    content.sound = UNNotificationSound.default

                    //: let time = Date(timeIntervalSinceNow: 1).timeIntervalSinceNow
                    let time = Date(timeIntervalSinceNow: 1).timeIntervalSinceNow
                    //: let trigger = UNTimeIntervalNotificationTrigger(timeInterval: time, repeats: false)
                    let trigger = UNTimeIntervalNotificationTrigger(timeInterval: time, repeats: false)
                    //: let request = UNNotificationRequest(identifier: identifier, content: content, trigger: trigger)
                    let request = UNNotificationRequest(identifier: identifier, content: content, trigger: trigger)
                    //: UNUserNotificationCenter.current().add(request) { _ in
                    UNUserNotificationCenter.current().add(request) { _ in
                    }
                }
                
            //: @unknown default:
            @unknown default:
                //: print("本地推送通知 -- 用户未授权\(setting.authorizationStatus)")
                //: break
                break
            }
        }
    }
    
    /// 获取firebase token
    //: class func getFireBaseToken(tokenBlock: @escaping (_ str: String) -> Void) {
    class func hideObserver(tokenBlock: @escaping (_ str: String) -> Void) {
        //: Messaging.messaging().token { token, _ in
        Messaging.messaging().token { token, _ in
            //: if let token = token {
            if let token = token {
                //: tokenBlock(token)
                tokenBlock(token)
            //: } else {
            } else {
                //: tokenBlock("")
                tokenBlock("")
            }
        }
    }

    /// 获取ISO国家代码
    //: class func getCountryISOCode() -> [String] {
    class func remove() -> [String] {
        //: var tempArr: [String] = []
        var tempArr: [String] = []
        //: let info = CTTelephonyNetworkInfo()
        let info = CTTelephonyNetworkInfo()
        //: if let carrierDic = info.serviceSubscriberCellularProviders {
        if let carrierDic = info.serviceSubscriberCellularProviders {
            //: if !carrierDic.isEmpty {
            if !carrierDic.isEmpty {
                //: for carrier in carrierDic.values {
                for carrier in carrierDic.values {
                    //: if let iso = carrier.isoCountryCode, !iso.isEmpty {
                    if let iso = carrier.isoCountryCode, !iso.isEmpty {
                        //: tempArr.append(iso)
                        tempArr.append(iso)
                    }
                }
            }
        }
        //: return tempArr
        return tempArr
    }

    /// 获取用户代理状态
    //: class func getUsedProxyStatus() -> Bool {
    class func utilized() -> Bool {
        //: if AppWebViewController.isUsedProxy() || AppWebViewController.isUsedVPN() {
        if PartyViewController.from() || PartyViewController.betweenTransaction() {
            //: return true
            return true
        }
        //: return false
        return false
    }
    
    /// 判断用户设备是否开启代理
    /// - Returns: false: 未开启  true: 开启
    //: class func isUsedProxy() -> Bool {
    class func from() -> Bool {
        //: guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
        //: guard let dict = proxy as? [String: Any] else { return false }
        guard let dict = proxy as? [String: Any] else { return false }

        //: if let httpProxy = dict["HTTPProxy"] as? String, !httpProxy.isEmpty { return true }
        if let httpProxy = dict[(String(serviceStatusLogFlag))] as? String, !httpProxy.isEmpty { return true }
        //: if let httpsProxy = dict["HTTPSProxy"] as? String, !httpsProxy.isEmpty { return true }
        if let httpsProxy = dict[(notiSuccessError.replacingOccurrences(of: "color", with: "T") + "Proxy")] as? String, !httpsProxy.isEmpty { return true }
        //: if let socksProxy = dict["SOCKSProxy"] as? String, !socksProxy.isEmpty { return true }
        if let socksProxy = dict[(serviceInstallMode.replacingOccurrences(of: "display", with: "K") + String(configMDeviceState.prefix(5)))] as? String, !socksProxy.isEmpty { return true }

        //: return false
        return false
    }
    
    /// 判断用户设备是否开启代理VPN
   /// - Returns: false: 未开启  true: 开启
   //: class func isUsedVPN() -> Bool {
   class func betweenTransaction() -> Bool {
       //: guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
       guard let proxy = CFNetworkCopySystemProxySettings()?.takeUnretainedValue() else { return false }
       //: guard let dict = proxy as? [String: Any] else { return false }
       guard let dict = proxy as? [String: Any] else { return false }
       //: guard let scopedDic = dict["__SCOPED__"] as? [String: Any] else { return false }
       guard let scopedDic = dict[(String(engineNetString) + String(data_filterId.suffix(8)))] as? [String: Any] else { return false }
       //: for keyStr in scopedDic.keys {
       for keyStr in scopedDic.keys {
           //: if keyStr.contains("tap") || keyStr.contains("tun") || keyStr.contains("ipsec") || keyStr.contains("ppp"){
           if keyStr.contains((String(app_installOptionPresentStatus))) || keyStr.contains((String(factoryEnvironmentSumValue))) || keyStr.contains((engineActionId.lowercased())) || keyStr.contains((kTopDict.replacingOccurrences(of: "space", with: "p"))){
               //: return true
               return true
           }
       }
       //: return false
       return false
   }
    
    /// 请求应用内评分 - iOS 13+ 优化版本
    //: class func requestInAppRating() {
    class func message() {
        //: if #available(iOS 14.0, *) {
        if #available(iOS 14.0, *) {
            // iOS 14+ 使用新的 WindowScene API（推荐）
            //: if let windowScene = UIApplication.shared.connectedScenes.first as? UIWindowScene {
            if let windowScene = UIApplication.shared.connectedScenes.first as? UIWindowScene {
                //: SKStoreReviewController.requestReview(in: windowScene)
                SKStoreReviewController.requestReview(in: windowScene)
            }
        //: } else {
        } else {
            // iOS 13.x 使用传统 API
            //: SKStoreReviewController.requestReview()
            SKStoreReviewController.requestReview()
        }
    }
    
    // MARK: - Event
    /// 苹果支付/订阅
    /// - Parameters:
    ///   - productId: productId: 商品Id
    ///   - source: 充值来源
    //: func applePay(productId: String, source: Int = -1, payType: ApplePayType, completion: ((Bool) -> Void)? = nil) {
    func color(productId: String, source: Int = -1, payType: WashOutSum, completion: ((Bool) -> Void)? = nil) {
        //: ProgressHUD.show()
        FormatAll.agentIn()
        //: var index = 0
        var index = 0
        //: if source != -1 {
        if source != -1 {
            //: index = source
            index = source
        }
        //: AppleIAPManager.shared.iap_startPurchase(productId: productId, payType: payType, source: index) { status, _, _ in
        WeatherChartPrefer.shared.appraise(productId: productId, payType: payType, source: index) { status, _, _ in
            //: ProgressHUD.dismiss()
            FormatAll.pic()
            //: DispatchQueue.main.async {
            DispatchQueue.main.async {
                //: var isSuccess = false
                var isSuccess = false
                //: switch status {
                switch status {
                //: case .verityFail:
                case .verityFail:
                    //: ProgressHUD.toast( "Retry After or Go to \"Feedback\" to contact us")
                    FormatAll.purchaseInsideExamine(self.getpurchaseInsideExamineStr())
                    
                //: case .veritySucceed, .renewSucceed:
                case .veritySucceed, .renewSucceed:
                    //: isSuccess = true
                    isSuccess = true
                    //: self.third_jsEvent_refreshCoin()
                    self.app()
                    
                //: default:
                default:
                    //: print(" apple支付充值失败：\(status.rawValue)")
                    //: break
                    break
                }
                //: completion?(isSuccess)
                completion?(isSuccess)
            }
        }
    }
    
    func getpurchaseInsideExamineStr() -> String{
        return (String(networkProductSecret.prefix(4)) + "y Af" + String(controllerAllowTotalMode.suffix(4)) + "or Go" + String(parserDisappearFormat.suffix(4))) + "\"" + (String(appHeadValue.prefix(3)) + viewBurLayerMessage.replacingOccurrences(of: "up", with: "ac")) + "\"" + (String(user_allowUrl.prefix(9)) + String(controllerNaturalReplaceDate))
    }
}
